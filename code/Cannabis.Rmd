---
editor_options: 
  markdown: 
    wrap: 72
---

# Cannabis

## Research Questions

Question 2. During the last 12 months, have you used marijuana (pot,
weed) or hashish (hash, hash oil) (for grade 5)

Question 3. During the last 12 months on how many occasions (if any)
have you used marijuana or hashish? (Do not count medical marijuana
prescribed for you by a doctor) (for grades 8,9,11)

Question 5. How much do you think people risk harming themselves
physically or in other ways if they use marijuana once or twice per week
grades 8,9,11)

For 2, I'm interested if it can be broken down by race/ethnicity and
then by region. For 3 the same- by race and then by region. I also
wonder about gender identity and if there is anything interesting in
that breakdown. For 5- the same. By grade and then by race, region and
gender identity.

```{r}
library(readr)
library(dplyr)
```

```{r}
race_no_county <- read_csv("../data/MSS22_Race_NoCounty/MSS22-3RaceNoCounty+Region.csv")
```

## Dictionary codebook

### Race

1 American Indian or Alaskan Native only

2 Asian or Asian American only

3 Black, African or African American only

4 Hispanic or Latino/a only

5 Middle Eastern or North African

6 Native Hawaiian or Other Pacific Islander only

7 White only

8 Multiple Races (checked more than one)

9 No answer

### Biosex

1-3: male, female, no answer

## Question 5 broken down by region

```{r}
data <- read_csv("../data/MSS22-3CountyNoRace/MSS22-3CountyNoRace.csv")
county_code <- read_csv("../code/complete_county_dict.csv")
```

```{r}
main <- data %>% left_join( county_code, 
           by=c('County'='Code'))
```

```{r}
data2 <- main %>% select(Region, biosex, A100A, A92)
```

```{r}

# Define the function
summarize_q5<- function(data, column) {
  res <- data %>% 
  group_by(!!sym(column)) %>% 
  summarize(
    `No Risk` = paste0(round(sum(A100A == 1, na.rm = TRUE) / n() * 100, 2), "%"),
    `Slight` = paste0(round(sum(A100A == 2, na.rm = TRUE) / n() * 100, 2), "%"),
    `Moderate` = paste0(round(sum(A100A == 3, na.rm = TRUE) / n() * 100, 2), "%"),
    `Great` = paste0(round(sum(A100A == 4, na.rm = TRUE) / n() * 100, 2), "%"),
    `NA` = paste0(round(sum(is.na(A100A)) / n() * 100, 2), "%")
  )
  return (res)
}
```

```{r}
report_5_biosex <- summarize_q5(data2, "biosex")
report_5_region <- summarize_q5(data2, "Region")
report_5_race <- summarize_q5(race_no_county, "Race")
```

```{r}
report_5_biosex
report_5_region 
report_5_race

# Pie Chart with Percentages
make_pie_chart <- function(slices, title)
    
slices <- c(11.89, 3.14, 9.7, 32.64, 42.63)

lbls <- c("No Risk", "Slight", "Moderate", "Great", "NA")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct)
# add percents to labels
lbls <- paste(lbls,"%",sep="") # ad % to labels
pie(slices,labels = lbls, col=rainbow(length(lbls)),
   main="Boy's Ratings on how much they think people risk harming themselves
physically or in other ways if they use marijuana once or twice per week") 


```

## Question 2

Question 2 cannot be attempted because too many NA data.

## Question 3

```{r}
# Define the function
summarize_q3 <- function(data, column) {
  res <- data %>% 
  group_by(!!sym(column)) %>% 
  summarize(
    `0 time` = paste0(round(sum(A92 == 1, na.rm = TRUE) / n() * 100, 2), "%"),
    `1 to 2` = paste0(round(sum(A92 == 2, na.rm = TRUE) / n() * 100, 2), "%"),
    `3 to 5` = paste0(round(sum(A92 == 3, na.rm = TRUE) / n() * 100, 2), "%"),
    `6 to 9` = paste0(round(sum(A92 == 4, na.rm = TRUE) / n() * 100, 2), "%"),
    `10 to 19` = paste0(round(sum(A92 == 5, na.rm = TRUE) / n() * 100, 2), "%"),
    `20 to 39` = paste0(round(sum(A92 == 6, na.rm = TRUE) / n() * 100, 2), "%"),
    `40 or more` = paste0(round(sum(A92 == 7, na.rm = TRUE) / n() * 100, 2), "%"),
    `NA` = paste0(round(sum(is.na(A92)) / n() * 100, 2), "%")
  )
  return (res)
}
```

```{r}
report_3_region <- summarize_q3(data2, "Region")
report_3_race <- summarize_q3(race_no_county, "Race")
```

```{r}
write_csv(report_3_region, "../result/report_3_region.csv")
write_csv(report_3_race, "../result/report_3_race.csv")
race_no_county
report_3_race
```
